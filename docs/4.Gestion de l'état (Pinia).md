# Gérer l'état global avec Pinia

Pinia est une bibliothèque de gestion d'état pour Vue.js qui permet de centraliser et de gérer l'état global de votre application de manière simple et efficace. Voici comment utiliser Pinia pour gérer l'état global dans une application Vue.js.

## 1. Installation de Pinia

Pour installer Pinia, vous pouvez utiliser npm ou yarn. Exécutez l'une des commandes suivantes dans votre terminal :

```bash
npm install pinia
```

## 2. Branchement de Pinia dans `src/main.js`

Comme pour le router, on doit enregistrer Pinia dans l'application :

```js
// ... imports précédents
import { createPinia } from "pinia" // Importation de Pinia

const app = createApp(App)
app.use(createPinia()) // Activation de Pinia

// ... reste du code
```

## 3. Création du store d'Authentification (`auth.js`)

Nous allons utiliser la syntaxe Composition API pour créer un store Pinia qui gère l'état d'authentification de l'utilisateur, y compris le token et les informations utilisateur.

Créez un fichier `auth.js` dans le dossier `src/stores/` :

```js
import { defineStore } from "pinia";
import { ref } from "vue";

export const useAuthStore = defineStore("auth", () => {
    // --- STATE ---
    const token = ref(localStorage.getItem("token") || null);
    const user = ref(JSON.parse(localStorage.getItem("user")) || null);

    // --- GETTERS ---
    const isAuthenticated = () => !!token.value;

    // --- ACTIONS ---
    function setToken(newToken) {
        token.value = newToken;
        localStorage.setItem("token", newToken);
    }

    function setUser(userData) {
        user.value = userData;
        localStorage.setItem("user", JSON.stringify(userData));
    }

    function logout() {
        token.value = null;
        user.value = null;
        localStorage.removeItem("token");
        localStorage.removeItem("user");
    }

    return { token, user, isAuthenticated, setToken, setUser, logout };
});
```

---

### Parallèle Svelte5 vs Pinia

En **Svelte 5**, on créerait un objet réactif exporté. En Pinia, ref() est ton état, computed() est ta donnée dérivée, et les fonctions sont tes actions. L'avantage de Pinia est l'intégration parfaite avec les outils de développement (Vue DevTools) pour voir l'état de l'application en temps réel.

---

## Test visuel dans `App.vue`

Pour tester notre store d'authentification, nous allons modifier le fichier `App.vue` pour afficher l'état d'authentification et permettre à l'utilisateur de se connecter et de se déconnecter.

Mettons à jour le header de `App.vue` pour afficher "Déconnexion" si l'utilisateur est connecté, sinon "Connexion".

```vue
<script setup>
import { useAuthStore } from './stores/auth';
import { useRouter } from 'vue-router';

const authStore = useAuthStore();
const router = useRouter();

const handleLogout = () => {
  authStore.logout();
  router.push('/login'); // Redirection vers la page de login
};
</script>

<template>
  <header class="bg-slate-800 text-white p-4 flex justify-between items-center shadow-md">
    <div class="flex gap-4">
      <RouterLink to="/" class="hover:text-yellow-400 font-medium">Accueil</RouterLink>
    </div>
    
    <div class="flex gap-4 items-center">
      <template v-if="!authStore.isAuthenticated">
        <RouterLink to="/login" class="hover:text-yellow-400 font-medium">Connexion</RouterLink>
      </template>
      
      <template v-else>
        <span class="text-slate-400">Salut, {{ authStore.user?.pseudo }}</span>
        <button 
          @click="handleLogout" 
          class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition-colors"
        >
          Déconnexion
        </button>
      </template>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4">
    <RouterView />
  </main>
</template>
```

---

### Pourquoi c'est important ?

Le store est maintenant **persistant** grâce à l'utilisation de `localStorage`. Si on rafraîchit la page, Pinia ira chercher le token stocké pour reconstruire l'état de l'authentification.
